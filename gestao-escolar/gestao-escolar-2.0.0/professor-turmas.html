<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Turmas - Professor</title>
    <link rel="stylesheet" href="css/professor-style.css">
</head>
<body>
    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="logo-section">
            <div class="logo-icon">ğŸ“</div>
            <h1 class="logo-text">EduGestÃ£o</h1>
        </div>
        <div class="user-section">
            <div class="user-info">
                <div class="user-name" id="userName">Professor</div>
                <div class="user-role">Minhas Turmas</div>
            </div>
            <button onclick="window.location.href='dashboard.html'" class="btn-back">â† Voltar</button>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <h1>ğŸ“š Minhas Turmas</h1>
            <p>Turmas em que vocÃª leciona neste ano letivo</p>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Carregando suas turmas...</p>
        </div>

        <!-- Turmas Grid -->
        <div id="turmasGrid" class="turmas-grid" style="display: none;">
            <!-- Turmas serÃ£o inseridas aqui -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-icon">ğŸ“š</div>
            <h3>Nenhuma turma encontrada</h3>
            <p>VocÃª ainda nÃ£o foi atribuÃ­do a nenhuma turma.</p>
            <p>Entre em contato com a coordenaÃ§Ã£o.</p>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/professor-auth.js"></script>
    <script>
        let currentUser = null;

        async function init() {
            currentUser = await checkProfessorAuth();
            if (!currentUser) return;

            document.getElementById('userName').textContent = 
                `${currentUser.first_name} ${currentUser.last_name}`;

            await loadTurmas();
        }

        async function loadTurmas() {
            try {
                // Buscar turmas do professor
                const turmas = await api.getTurmas();
                
                document.getElementById('loading').style.display = 'none';

                if (!turmas.results || turmas.results.length === 0) {
                    document.getElementById('emptyState').style.display = 'block';
                    return;
                }

                const grid = document.getElementById('turmasGrid');
                grid.style.display = 'grid';

                turmas.results.forEach(turma => {
                    const card = createTurmaCard(turma);
                    grid.appendChild(card);
                });

            } catch (error) {
                console.error('Erro ao carregar turmas:', error);
                document.getElementById('loading').innerHTML = `
                    <p style="color: #ef4444;">Erro ao carregar turmas</p>
                    <button onclick="location.reload()" class="btn-primary">Tentar Novamente</button>
                `;
            }
        }

        function createTurmaCard(turma) {
            const card = document.createElement('div');
            card.className = 'turma-card';
            card.innerHTML = `
                <div class="turma-header">
                    <h3>${turma.nome}</h3>
                    <span class="badge">${turma.serie}</span>
                </div>
                <div class="turma-info">
                    <div class="info-item">
                        <span class="label">Turno:</span>
                        <span class="value">${getTurnoLabel(turma.turno)}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Sala:</span>
                        <span class="value">${turma.sala}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Ano Letivo:</span>
                        <span class="value">${turma.ano_letivo}</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Alunos:</span>
                        <span class="value">${turma.total_alunos || 0}/${turma.capacidade_maxima}</span>
                    </div>
                </div>
                <div class="turma-actions">
                    <button onclick="verAlunos(${turma.id})" class="btn-action">
                        ğŸ‘¥ Ver Alunos
                    </button>
                    <button onclick="lancarNotas(${turma.id})" class="btn-action">
                        ğŸ“ LanÃ§ar Notas
                    </button>
                    <button onclick="lancarFaltas(${turma.id})" class="btn-action">
                        ğŸ“… LanÃ§ar Faltas
                    </button>
                </div>
            `;
            return card;
        }

        function getTurnoLabel(turno) {
            const turnos = {
                'matutino': 'Matutino',
                'vespertino': 'Vespertino',
                'noturno': 'Noturno'
            };
            return turnos[turno] || turno;
        }

        async function verAlunos(turmaId) {
            window.location.href = `professor-alunos.html?turma=${turmaId}`;
        }

        function lancarNotas(turmaId) {
            window.location.href = `professor-notas.html?turma=${turmaId}`;
        }

        function lancarFaltas(turmaId) {
            window.location.href = `professor-faltas.html?turma=${turmaId}`;
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
